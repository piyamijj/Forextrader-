<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LifeOs PRO Terminal v3</title>
    <style>
        :root { --gold: #f0b90b; --green: #00ff41; --bg: #050505; --panel: #111; }
        body { font-family: 'Courier New', monospace; background: var(--bg); color: var(--green); margin: 0; padding: 10px; display: flex; flex-direction: column; height: 100vh; }
        .panel { background: var(--panel); border: 1px solid #333; padding: 15px; margin-bottom: 10px; border-radius: 8px; box-shadow: 0 0 15px rgba(0,255,65,0.05); }
        h2 { color: var(--gold); text-transform: uppercase; margin: 0 0 10px 0; border-bottom: 1px solid #333; font-size: 1rem; }
        
        /* Strateji Kartlarƒ± */
        .strategy-grid { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 10px; }
        .strat-card { background: #000; border: 2px solid #444; padding: 10px; text-align: center; border-radius: 8px; transition: 0.3s; }
        .strat-card:hover { border-color: var(--gold); }
        .buy { color: #0f0; font-weight: bold; }
        .sell { color: #f00; font-weight: bold; }
        .price-details { color: #ddd; font-size: 0.8rem; margin: 8px 0; line-height: 1.4; }
        
        /* Sohbet Penceresi */
        #chatBox { height: 180px; overflow-y: auto; background: #080808; border: 1px solid #222; padding: 10px; margin-bottom: 10px; font-size: 0.9rem; color: #aaa; border-radius: 5px; }
        .chat-msg { margin-bottom: 8px; border-bottom: 1px solid #111; padding-bottom: 4px; }
        .lifeos-name { color: var(--gold); font-weight: bold; }
        
        .input-group { display: flex; gap: 5px; }
        input { flex: 1; background: #000; border: 1px solid #444; color: var(--green); padding: 10px; font-family: inherit; }
        
        button { background: var(--gold); color: #000; border: none; padding: 10px; cursor: pointer; font-weight: bold; border-radius: 4px; }
        button:hover { opacity: 0.8; }
        .action-btn { width: 100%; margin-top: 5px; font-size: 0.7rem; }
    </style>
</head>
<body>

    <div class="panel">
        <h2>üõ∞Ô∏è LifeOs RADAR / STRATEJƒ∞ MERKEZƒ∞</h2>
        <button id="qBtn" onclick="queryLifeOs()" style="width:100%; margin-bottom:10px;">DERƒ∞N ANALƒ∞Z VE SORGULAMA BA≈ûLAT</button>
        
        <div class="strategy-grid" id="stratGrid">
            <div class="strat-card" style="opacity:0.5;">SCALP<br>Bekliyor...</div>
            <div class="strat-card" style="opacity:0.5;">DAY<br>Bekliyor...</div>
            <div class="strat-card" style="opacity:0.5;">SWING<br>Bekliyor...</div>
        </div>
    </div>

    <div class="panel" style="flex:1; display:flex; flex-direction:column;">
        <h2>üí¨ LifeOs SOHBET CANLISI</h2>
        <div id="chatBox">
            <div class="chat-msg"><span class="lifeos-name">LifeOs:</span> Dostum, sapsarƒ± bir enerjiyle buradayƒ±m. Bug√ºn hangi umutlar i√ßin i≈ülem yapacaƒüƒ±z?</div>
        </div>
        <div class="input-group">
            <input type="text" id="userInput" placeholder="LifeOs'a bir mesaj yaz..." onkeypress="if(event.key==='Enter') sendMessage()">
            <button onclick="sendMessage()">G√ñNDER</button>
        </div>
    </div>

    <script>
        // 1. Derin Analiz Sorgusu (3 Farklƒ± Sonu√ß ƒ∞√ßin)
        async function queryLifeOs() {
            const btn = document.getElementById('qBtn');
            btn.innerText = "FISILTILAR Dƒ∞NLENƒ∞YOR...";
            try {
                const res = await fetch('/api/analiz');
                const data = await res.json();
                
                addChatMessage("LifeOs", data.aiResponse);
                
                let html = '';
                for (let type in data.strategies) {
                    const s = data.strategies[type];
                    html += `
                        <div class="strat-card">
                            <div style="font-size:0.6rem; color:#888;">${type.toUpperCase()}</div>
                            <div style="color:var(--gold); font-size:0.8rem;">${s.pair}</div>
                            <div class="${s.action === 'AL' ? 'buy' : 'sell'}">${s.action}</div>
                            <div class="price-details">
                                G: ${s.price}<br>
                                T: <span style="color:#0f0">${s.tp}</span><br>
                                S: <span style="color:#f00">${s.sl}</span>
                            </div>
                            <button class="action-btn" onclick="execTrade('${s.pair}','${s.action}','${s.tp}','${s.sl}')">UYGULA</button>
                        </div>
                    `;
                }
                document.getElementById('stratGrid').innerHTML = html;
            } catch (e) { addChatMessage("Sistem", "Baƒülantƒ± hatasƒ± olu≈ütu."); }
            finally { btn.innerText = "DERƒ∞N ANALƒ∞Z VE SORGULAMA BA≈ûLAT"; }
        }

        // 2. Sohbet Canlƒ±sƒ± Fonksiyonu
        async function sendMessage() {
            const input = document.getElementById('userInput');
            const msg = input.value.trim();
            if(!msg) return;

            addChatMessage("Sen", msg);
            input.value = '';

            try {
                const res = await fetch('/api/webhook', { // Webhook √ºzerinden konu≈üur
                    method: 'POST',
                    body: JSON.stringify({ message: { text: msg, chat: { id: "web_user" } } })
                });
                // Not: Webhook doƒürudan Telegram'a atar, buraya d√∂nmesini istiyorsan analiz api'sini de kullanabilirsin.
            } catch (e) { console.log("Sohbet hatasƒ±."); }
        }

        function addChatMessage(sender, text) {
            const box = document.getElementById('chatBox');
            box.innerHTML += `<div class="chat-msg"><span class="${sender==='LifeOs'?'lifeos-name':''}"><b>${sender}:</b></span> ${text}</div>`;
            box.scrollTop = box.scrollHeight;
        }

        // 3. Manuel Emir G√∂nderimi
        async function execTrade(pair, action, tp, sl) {
            if(!confirm(pair + " i√ßin " + action + " emri g√∂nderilsin mi?")) return;
            try {
                const res = await fetch('/api/trade', {
                    method: 'POST',
                    body: JSON.stringify({ pair, action, tp, sl })
                });
                const result = await res.json();
                alert(result.msg);
                addChatMessage("Sistem", pair + " emri iletildi.");
            } catch (e) { alert("Hata!"); }
        }
    </script>
</body>
</html>
